<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.company.pingPong.dao.PingPongDao">
	<select id="loginIdDao" parameterType="String" resultType="int">
		SELECT COUNT(id) FROM member WHERE id = #{id}
	</select>
	
	<select id="loginDao" parameterType="java.util.Map" resultType="com.company.pingPong.dto.MemberDto">
		SELECT * FROM member WHERE id = #{id} AND password = #{pwd}
	</select>
	
	<select id="loginPwdDao" parameterType="String" resultType="int">
		SELECT COUNT(password) FROM member WHERE password = #{pwd}
	</select>
	
	<select id="loginNameDao" parameterType="java.util.Map" resultType="String">
		SELECT name FROM member WHERE id = #{id} AND password = #{pwd}
	</select>
	
	<insert id="joinApplyAccountDao" parameterType="com.company.pingPong.dto.MemberDto">
		INSERT INTO member(member_code, id, password, manager_status, coach_status, name, age, sex, tel, email, addr, birthday, style, grade, note) VALUES((SELECT NVL(MAX(member_code)+1,1)FROM member), #{id}, #{password}, #{manager_status}, #{coach_status}, #{name}, #{age}, #{sex}, #{tel}, #{email}, #{addr}, #{birthday}, #{style}, #{grade}, #{note})
	</insert>
	
	<select id="findMonthAndMemberDao" parameterType="String" resultType="com.company.pingPong.dto.MemberDto">
		SELECT m.member_code, m.name, m.sex, mt.fee_status FROM member m LEFT OUTER JOIN monthmember mt ON m.member_code = mt.member_code WHERE m.name = #{memberName} AND m.approval_status = 1
	</select>
	
	<select id="getAccountListDao" resultType="com.company.pingPong.dto.MemberDto">
		SELECT a.account_code, a.id, a.manager_status, a.coach_status, m.name, m.sex, m.tel, m.registerday FROM member m LEFT OUTER JOIN account a ON m.member_code = a.member_code
	</select>
	
	<select id="getConfirmListDao" resultType="com.company.pingPong.dto.AccountDto">
		SELECT account_code, id, manager_status, coach_status, join_date FROM account WHERE manager_status = 2 OR coach_status = 2
	</select>
	
	<update id="managerConfirmDao" parameterType="java.util.Map">
		UPDATE account SET manager_status = ${managerStatus} WHERE account_code = ${accountCode}
	</update>
	
	<update id="coachConfirmDao">
		UPDATE account SET coach_status = ${coachStatus} WHERE account_code = ${accountCode}
	</update>
	
	<select id="getFeeList" resultType="com.company.pingPong.dto.FeeDto">
		SELECT fee.*, member.member_code, member.name FROM fee LEFT OUTER JOIN (
		(SELECT lesson.fee_code, member.member_code, member.name FROM lesson LEFT OUTER JOIN member ON lesson.member_code = member.member_code) UNION ALL
		(SELECT monthmember.fee_code, member.member_code, member.name FROM monthmember LEFT OUTER JOIN member ON monthmember.member_code = member.member_code) )member
		ON fee.fee_code = member.fee_code ORDER BY fee_date DESC
	</select>
	
	<select id="getDateFeeList" parameterType="String" resultType="com.company.pingPong.dto.FeeDto">
		SELECT fee.*, member.member_code, member.name FROM fee LEFT OUTER JOIN (
		(SELECT lesson.fee_code, member.member_code, member.name FROM lesson LEFT OUTER JOIN member ON lesson.member_code = member.member_code) UNION ALL
		(SELECT monthmember.fee_code, member.member_code, member.name FROM monthmember LEFT OUTER JOIN member ON monthmember.member_code = member.member_code) )member
		ON fee.fee_code = member.fee_code WHERE to_date(fee_date) = #{searchFeeDate} ORDER BY fee_date DESC
	</select>
	
	<insert id="insertGeneralFeeDao" parameterType="java.util.Map">
		INSERT INTO fee(fee_code, fee_type, fee_amount, note) VALUES((SELECT NVL(MAX(fee_code)+1,1)FROM fee), #{feeType}, #{feeAmount}, #{feeNote})
	</insert>
	
	<insert id="insertOneDayFeeDao" parameterType="java.util.Map">
		INSERT INTO fee(fee_code, fee_type, fee_amount, note) VALUES((SELECT NVL(MAX(fee_code)+1,1)FROM fee), #{feeType}, #{feeAmount}, #{feeNote})
	</insert>
	<!-- #{param} is considering database data type
		${param} is non-considering database data type -->
	<!-- <insert id="writeDao">
		INSERT INTO BOARD (MID, MWRITER, MCONTENT) VALUES (BOARD_SEQ.NEXTVAL, #{param1}, #{param2})
	</insert>
	
	<delete id="deleteDao">
		DELETE FROM BOARD WHERE MID = #{param1}
	</delete> -->
</mapper>